\documentclass{article}
\usepackage[latin2]{inputenc}
\usepackage[czech]{babel}
\usepackage{a4wide}
\usepackage{url}
\author{Ale¹ Hakl\footnote{\texttt{hakla1@fel.cvut.cz}}}
\title{\texttt{ncc} - Kompilátor do LLVM IR}

\begin{document}
\maketitle

\section{Úvod}

Rozhodl jsem se, ¾e jako semestrální práci naprogramuji kompilátor
podmno¾iny jazyka C do vnitøní reprezentace pou¾ívané knihovnou
LLVM. Mojí hlavní motivací bylo vyzkou¹et, jak se tato knihovna
vlastnì pou¾ívá, a jestli je jí mo¾né pou¾ít pro dynamycké generování
kódu v mém projektu\cite{dfsch}. Závìry z tohoto pokusu jsou celkem
rozporuplné.

\section{Pou¾ití}

Program \texttt{ncc} naèítá kód ze souboru jeho¾ jméno je uvedeno
na pøíkazové øádce. Po jeho naètení umí v závislosti na pøedaných
volbách pøíkazové øádky provést tøi rùzné operace (èi jejich
libovolnou kombinaci):

\begin{itemize}
  \item Vypsat abstraktní szntaktzcký strom na chybový výstup v
    pøípadì pou¾ití volby \texttt{--dump-ast}
  \item Vypsat textovou formu vnitøní reprezentace programu na chybový
    výstup (\texttt{--dump-ir})
  \item Zavolat funkci main() definovanou v zadaném
    programu. (\texttt{--run}) 
\end{itemize}


\section{Vstupní jazyk}
Jak u¾ jsem zmínil, vstupem mého kompilátoru je podmno¾ina jazyka
C. Obsahuje:
\begin{itemize}
  \item Èíselné typy \texttt{int} a \texttt{float}\footnote{Který je
    pøeveden na datový typ \texttt{double}, nicménì pova¾uji za
    matoucí, aby se jediný podporovaný FP typ jmenoval
    \texttt{double}.}.
  \item Neprùhledný typ \texttt{ptr} podobný typu \texttt{void *} z C,
    se kterým nelze provádìt ¾ádné jiné operace ne¾ pøedání funkci
    jako parametr.
  \item Øídící struktury \texttt{if}, \texttt{while} a logické
    operátory se zkráceným vyhodnocováním.
  \item Globální a lokální promìnné.
  \item Deklarace funkcí.
  \item Prakticky v¹echny aritmetické operátory ze standardního C s
    vyjímkou pøiøazovacích.
  \item Relaèní operátory
  \item Ternární operátor
\end{itemize}

\begin{verbatim}
type ::= 'int' | 'float' | 'ptr'
\end{verbatim}

Vstupní soubor obsahuje posloupnost deklarací funkcí a promìných a definicí 
funkcí (v libovolném poøadí).

\begin{verbatim}
input-file ::= top-level*
top-level ::= variable-declaration | function-declaration | function-definition
variable-declaration ::= type identifier ';'
function-declaration ::= function-prototype ';'
function-definition ::= function-prototype block
function-prototype ::= type identifier 
                       '(' ( type identifier ( ',' type identifier)* )? ')'
\end{verbatim}

Blok je posloupností pøíkazù, pøièem¾ za pøíkaz je pova¾ována i
definice lokální promìnné\footnote{Tedy to co ISO C99 nazývá
  \textit{block-item}}.

\begin{verbatim}
block ::= '{' statement* '}'
statement ::= local-variable | block | return-statement | 
              if-statement | while-statement | comma-expression ';'
\end{verbatim}

Pøíkazy \texttt{if}, \texttt{while} a \texttt{return} odpovídají
shodným konstrukcím jazyka C\footnote{s výjimkou faktu, ¾e definice
  lokální promìnné je také platným pøíkazem, co¾ je ov¹em pro
  programátora nezajímavé, pouze to ponìkud zjednodu¹uje definici
  jazyka a implementaci parseru}.

\begin{verbatim}
if-statement ::= 'if' '(' comma-expression ')' statement 
                 ('else' statement)?
while-statement ::= 'while' '(' comma-expression ')' statement
return-statement ::= 'return' comma-expression ';'
\end{verbatim}

Syntaxe výrazù odpovídá s vyjímkou vypu¹tìných operátorù syntaxi
jazyka C a nepova¾uji za úèelné ji zde uvádìt kompletní. Podporované
operátory jsou: \texttt{+}, \texttt{*}, \texttt{-}, \texttt{/},
\texttt{\&}, \texttt{|}, \texttt{\^}, \texttt{==}, \texttt{!=},
\texttt{<}, \texttt{>}, \texttt{<=}, \texttt{>=}, \texttt{,},
\texttt{\&\&}, \texttt{||}, \texttt{=}, unární \texttt{-}, \texttt{\~},
\texttt{!} a koneènì ternární operátor \texttt{?:}. Jediná podporovaná
l-hodnota je promìnná, na levé stranì pøiøazovacího výrazu tedy smí
stát pouze ta.

Definice lokální promìnné umo¾òuje její inicializaci zadaným výrazem,
na rozdíl od C nesmí tento výraz zaèínat pøiøazením.

\begin{verbatim}
local-variable ::= type IDENTIFIER ( '=' ternary-expression )?';'
\end{verbatim}

\section{Implementaèní poznámky}

\section{Závìr}

\begin{thebibliography}{9}
  \bibitem{dfsch} Ale¹ Hakl \textsl{dfsch - Scheme-like dialect of
    LISP}. \url{http://hakl.net/software/dfsch/} 
\end{thebibliography}

\end{document}
